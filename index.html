<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Статистика Текста Виджет</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Загрузка React и ReactDOM (UMD версии для максимальной совместимости) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel для обработки JSX прямо в браузере -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 3px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      body {
        background-color: #ffffff;
        margin: 0;
        padding: 0;
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      }
      /* Стили для изоляции виджета, чтобы стили сайта не ломали его */
      #text-stats-widget-root {
        all: initial; /* Сброс наследования стилей */
        font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        display: block;
        width: 100%;
      }
      #text-stats-widget-root * {
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <!-- Уникальный ID для контейнера, чтобы избежать конфликтов -->
    <div id="text-stats-widget-root"></div>

    <script type="text/babel">
      // Используем глобальные переменные React вместо import
      const { useState, useMemo, useRef, useEffect } = React;
      
      const StatBox = ({ label, value }) => (
        <div className="flex flex-col items-center justify-center p-3 bg-slate-50 rounded-lg border border-slate-100 hover:border-blue-200 transition-colors">
          <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1 text-center leading-tight">{label}</span>
          <span className="text-xl font-bold text-slate-700">{value}</span>
        </div>
      );

      const App = () => {
        const [text, setText] = useState('');
        const textareaRef = useRef(null);

        // Логика автоматического изменения высоты
        useEffect(() => {
          const textarea = textareaRef.current;
          if (!textarea) return;

          // Сбрасываем высоту на auto, чтобы правильно рассчитать scrollHeight при удалении текста
          textarea.style.height = 'auto';

          const minHeight = 256; // Начальная высота (соответствует h-64 или 16rem)
          const maxHeight = minHeight * 3; // Максимальная высота (в 3 раза больше)

          // Вычисляем новую высоту: не меньше минимума, не больше максимума
          const newHeight = Math.min(Math.max(textarea.scrollHeight, minHeight), maxHeight);
          
          textarea.style.height = `${newHeight}px`;
        }, [text]);

        // Вычисление статистики
        const stats = useMemo(() => {
          const trimmed = text.trim();
          if (!trimmed) {
            return { characters: 0, charactersNoSpaces: 0, words: 0, sentences: 0, paragraphs: 0, readingTime: '0 с' };
          }

          const characters = text.length;
          // Удаляем пробелы и переносы строк для подсчета "без пробелов"
          const charactersNoSpaces = text.replace(/\s/g, '').length;
          // Разбиваем по пробельным символам для подсчета слов
          const words = trimmed.split(/\s+/).length;
          // Разбиваем по знакам препинания (. ! ?) для подсчета предложений
          const sentences = text.split(/[.!?]+/).filter(t => t.trim().length > 0).length;
          // Разбиваем по переводам строки для подсчета абзацев
          const paragraphs = text.split(/\n+/).filter(t => t.trim().length > 0).length;
          
          const readingTimeSeconds = Math.ceil(words / (200 / 60)); // Примерно 200 слов в минуту
          const readingTime = readingTimeSeconds > 60 
            ? `${Math.ceil(readingTimeSeconds / 60)} мин` 
            : `${readingTimeSeconds} с`;

          return { characters, charactersNoSpaces, words, sentences, paragraphs, readingTime };
        }, [text]);

        return (
          <div className="w-full max-w-3xl mx-auto p-4 bg-white text-slate-800 antialiased">
            {/* Заголовок виджета */}
            <header className="flex items-center gap-3 mb-5 border-b border-slate-100 pb-4">
               <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-sm shrink-0">
                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8"/></svg>
               </div>
               <div>
                 <h1 className="text-xl font-bold text-slate-900 leading-tight m-0">Анализ Текста</h1>
                 <p className="text-sm text-slate-400 font-medium m-0">Статистика символов и слов</p>
               </div>
            </header>

            {/* Область ввода */}
            <div className="relative group mb-6">
              <textarea
                ref={textareaRef}
                value={text}
                onChange={(e) => setText(e.target.value)}
                placeholder="Введите или вставьте текст для подсчета статистики..."
                className="w-full p-5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-base text-slate-700 placeholder:text-slate-400 leading-relaxed block overflow-y-auto resize-none"
                spellCheck="true"
                style={{ minHeight: '256px' }}
              />
              {text && (
                <button 
                  onClick={() => setText('')}
                  className="absolute top-3 right-3 p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors cursor-pointer bg-transparent border-none"
                  title="Очистить"
                  type="button"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
              )}
            </div>

            {/* Панель статистики */}
            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3">
              <StatBox label="Всего знаков" value={stats.characters} />
              <StatBox label="Без пробелов" value={stats.charactersNoSpaces} />
              <StatBox label="Слов" value={stats.words} />
              <StatBox label="Предложений" value={stats.sentences} />
              <StatBox label="Абзацев" value={stats.paragraphs} />
              <StatBox label="Время чтения" value={stats.readingTime} />
            </div>
          </div>
        );
      };

      // Инициализация приложения
      const container = document.getElementById('text-stats-widget-root');
      const root = ReactDOM.createRoot(container);
      root.render(<App />);
    </script>
  </body>
</html>